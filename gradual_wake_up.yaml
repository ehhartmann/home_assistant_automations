blueprint:
  name: Gradual Wake-Up Light (Hue or any dimmable light)
  description: >
    Gradually turns on a light over a configurable fade duration and color temperature.
    Can be configured to run on weekdays or weekends using a weekday sensor.
  domain: automation

  input:
    light_entity:
      name: Target Light
      description: The light entity to fade on.
      selector:
        entity:
          domain: light

    start_time:
      name: Wake-Up Time Helper
      description: Select an input_datetime entity that holds the wake-up time.
      selector:
        entity:
          domain: input_datetime

    fade_duration:
      name: Fade Duration (minutes)
      description: How long the fade should last.
      default: 20
      selector:
        number:
          min: 1
          max: 60
          unit_of_measurement: minutes
          step: 1
          mode: slider
          
    light_off_duration:
      name: Light Off Duration (minutes)
      description: How long to wait before turning off the light.
      default: 30
      selector:
        number:
          min: 1
          max: 60
          unit_of_measurement: minutes
          step: 1
          mode: slider
          
    color_temp:
      name: Color Temperature (mired)
      description: Light color temperature during fade.
      default: 370
      selector:
        number:
          min: 153
          max: 500
          step: 10
          unit_of_measurement: mired
          mode: slider

    weekday_sensor:
      name: Weekday Sensor
      description: >
        A binary_sensor that is 'on' during weekdays (for example: binary_sensor.workday_sensor).
      default: binary_sensor.workday_sensor
      selector:
        entity:
          domain: binary_sensor

    active_days:
      name: Active Days
      description: Choose when this automation should run.
      default: weekdays
      selector:
        select:
          options:
            - label: Weekdays only
              value: weekdays
            - label: Weekends only
              value: weekends

mode: restart

trigger:
  - platform: time
    at: !input start_time

variables:
  input_weekday_sensor: !input weekday_sensor
  input_active_days: !input active_days
  light: !input light_entity
  duration: !input fade_duration
  color_temp: !input color_temp
  steps: 30
  step_delay: "{{ (duration * 60 / steps) | int }}"
  off_duration: !input light_off_duration

condition:
  - condition: template
    value_template: >
      {% set is_weekday = states(input_weekday_sensor) == 'on' %}
      {{ (input_active_days == 'weekdays' and is_weekday) or
         (input_active_days == 'weekends' and not is_weekday) }}

action:
  - service: light.turn_on
    target:
      entity_id: "{{ light }}"
    data:
      brightness: 1
      color_temp: "{{ color_temp }}"

  - repeat:
      count: "{{ steps }}"
      sequence:
        - service: light.turn_on
          target:
            entity_id: "{{ light }}"
          data:
            brightness: "{{ (repeat.index / steps * 255) | int }}"
            color_temp: "{{ color_temp }}"
            transition: "{{ step_delay }}"
        - delay:
            seconds: "{{ step_delay }}"

  - delay:
      minutes: "{{ off_duration }}"

  - service: light.turn_off
    target:
      entity_id: "{{ light }}"

